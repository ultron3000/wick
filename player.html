<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="referrer" content="no-referrer">

<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.compiled.min.js"></script>

<style>
html,body{margin:0;height:100%;background:#000}
video{width:100%;height:100%}
</style>
</head>

<body>

<video id="video" controls autoplay></video>

<script>
/* ðŸ”´ ADD THESE LINES â€” START */
shaka.polyfill.installAll();

if (!shaka.Player.isBrowserSupported()) {
  alert("Browser not supported for DRM playback");
  throw new Error("Shaka unsupported");
}
/* ðŸ”´ ADD THESE LINES â€” END */

const src = new URLSearchParams(location.search).get("src");
if(!src) alert("No source");

fetch("jio.m3u")
.then(r=>r.text())
.then(txt=>{
  const lines = txt.split("\n");
  let mpd="", key="";

  for(let i=0;i<lines.length;i++){
    if(lines[i].includes(src)){
      for(let j=i;j>=0;j--){
        if(lines[j].includes("license_key")){
          key = lines[j].split("=")[1];
          break;
        }
      }
      mpd = src;
      break;
    }
  }

  const [kid,k] = key.split(":");

  const video = document.getElementById("video");
  const player = new shaka.Player(video);

  player.configure({
    drm:{ clearKeys:{ [kid]:k } }
  });

  player.load(mpd).catch(e=>{
    console.error(e);
    alert("Playback failed");
  });
});
</script>


</body>
</html>
